---
layout: post
title:  "交换机 MTU 配置总结"
date:   2017-09-18
categories: NSX
tags: NSX VXLAN MTU 交换机
typora-root-url: ../../halfcoffee
---

* content
{:toc}
> 摘要：在使用基于VXLAN的SDN解决方案时，对物理网络的基本要求是修改MTU，让其大于1500，下面总结了几大厂商不同型号或版本交换机的配置，以后会不断更新，也请有过配置经验的同行帮忙补充

## 配置简介

一般配置MTU时，需要配置端到端沿途所有设备，如果源和目标在同一个网段，则只需要配置沿途所有设备的二层接口MTU。一般按照设备不同，可能需要全局配置MTU，或者在对应接口上配置MTU。

如果源和目的在不同的网段内，除了配置沿途所有二层接口MTU外，还需配置两个网段网关接口(三层接口)的MTU。

一般配置方式是interface vlan 100，mtu 1600。

## Cisco

### Catalyst 4500系列交换机

> 已知可用交换机版本：C4506 IOS 12.2

Cisco C4500系列交换机请检查板卡兼容性，一些老设备可能无法支持MTU>1570 [https://www.cisco.com/c/en/us/support/docs/switches/catalyst-4000-series-switches/29805-175.html#topic3](https://www.cisco.com/c/en/us/support/docs/switches/catalyst-4000-series-switches/29805-175.html#topic3)

**二层接口MTU**：`system mtu 1600 `

只能全局配置

检查命令：`show system mtu`或者

```
show interface G0/0

 GigabitEthernet1/3 is up, line protocol is up (connected) 
  Hardware is Gigabit Ethernet Port, address is 588d.097e.9982 (bia 588d.097e.9982)
 MTU 1600 bytes, BW 1000000 Kbit, DLY 10 usec, 
  reliability 255/255, txload 6/255, rxload 21/255
  Encapsulation ARPA, loopback not set
```



**三层接口MTU**：


```
interface vlan 200
mtu 9000
```

### 2960、3560、3750

> 2960 IOS 12.2 ，3560 12.2，3750 15.0

**全局配置FastEthernet接口MTU：**

`system mtu 1600`

**全局配置GigabitEthernet接口MTU**

**(如果不配置，则继承system mtu配置)：**

`system mtu jumbo 1600`



**三层接口 MTU：**

**全局** ：`system mtu routing 1600`

**接口下**（接口下优先）：

```
interface vlan 100
 mtu 1600
```

### **大包测试**

```
!-- 从交换机SW1 ping SW2，1570 字节的包，成功

SW1#ping 192.168.12.2 size 1550 df-bit

Type escape sequence to abort.

Sending 5, 1550-byte ICMP Echos to 192.168.12.2, timeout is 2 seconds:

Packet sent with the DF bit set

!!!!!

Success rate is 100 percent (5/5), round-trip min/avg/max = 1/202/1006 ms
```

```
!-- 从交换机SW1 ping SW2 ，1600 字节的包，失败

SW1#ping 192.168.12.2 size 1600 df-bit 

Type escape sequence to abort.

Sending 5, 1600-byte ICMP Echos to 192.168.12.2, timeout is 2 seconds:

Packet sent with the DF bit set

.....

Success rate is 0 percent (0/5)

```

```
!-- 在SW2的 f0/13 口可以看到失败的包(5 giants) 

SW2#sh int f0/13 | in (MTU|giants|packets )
  MTU 1550 bytes, BW 100000 Kbit, DLY 100 usec,
82 packets input, 23609 bytes, 0 no buffer
0 runts, 5 giants, 0 throttles
0 input packets with dribble condition detected
749 packets output, 64729 bytes, 0 underruns
```



## 华为

> S1700，2700，5700

**二层接口MTU**，命令支持Ethernet接口视图、GE接口视图、XGE接口视图、MultiGE接口视图、40GE接口视图、端口组视图、Eth-Trunk接口视图

```
<HUAWEI> system-view

[HUAWEI] interface gigabitethernet 0/0/1

[HUAWEI-GigabitEthernet0/0/1] jumboframe enable 5000
```



**三层MTU：**

```
[HUAWEI] interface Vlanif 100
[HUAWEI-Vlanif100] mtu 1492
```



``` 
[HUAWEI] interface gigabitethernet 0/0/1

[HUAWEI-GigabitEthernet0/0/1] undo portswitch

[HUAWEI-GigabitEthernet0/0/1] mtu 1600

[HUAWEI-GigabitEthernet0/0/1] restart
```

重启接口生效。



## 华三



## 锐捷

> S8610 version11

**三层接口MTU:**

```
interface interface AggregatePort 10
no switchport
mtu 9216
```

**检查：**

```

show interface agg 10
AggregatePort 10 is UP  , line protocol is UP   
  Hardware is AggregateLink AggregatePort, address is 1414.4b82.25e1 (bia 1414.4b82.25e1)
  Description: Link-To-Gold3_HR_VmWare
  Interface address is: 172.16.1.1/24
  ARP type: ARPA, ARP Timeout: 3600 seconds
  Interface IPv6 address is:
No IPv6 address
MTU 9216 bytes, BW 20000000 Kbit
```